# hw definition file for processing by chibios_pins.py
# F415 layout

MCU STM32F4xx STM32F415xx

# board ID for firmware load - board id aussuchen, wird vom bootloader and die gcs gegeben um zu schauen ob die firmware kompatibel ist
APJ_BOARD_ID 9

# crystal frequency
OSCILLATOR_HZ 25000000

# die hier richtig Ã¤ndern
STM32_HSE_ENABLED TRUE
STM32_PLLM_VALUE 25
STM32_PLLN_VALUE 288
STM32_PLLP_VALUE 2
STM32_PLLQ_VALUE 6
STM32_PLLSRC STM32_PLLSRC_HSE
STM32_PREE1  STM32_PREE1_DIV1
STM32_PREE2  STM32_PREE2_DIV1

#STM32_PWM_USE_TIM3 TRUE

# board voltage
STM32_VDD 330U

# flash size
FLASH_SIZE_KB 1024

# order of I2C buses
I2C_ORDER I2C2 I2C1

# we need I2C clock at 400kHz for IMU - unsicher
#define HAL_I2C_MAX_CLOCK 400000

# run I2C bus thread at high priority for IMU - keine ahnung warum das so sollte
# define APM_I2C_PRIORITY 181

# USB setup
USB_VENDOR 0x0483 # ST
USB_PRODUCT 0x5740
USB_STRING_MANUFACTURER "ArduPilot"
USB_STRING_PRODUCT "%BOARD%"
USB_STRING_SERIAL  "%SERIAL%"

# The normal usage of this ordering is:
# 1) SERIAL0: console (primary mavlink, usually USB)
# 2) SERIAL3: primary GPS
# 3) SERIAL1: telem1
# 4) SERIAL2: telem2
# 5) SERIAL4: GPS2
# 6) SERIAL5: extra UART (usually RTOS debug console)

# order of UARTs
UART_ORDER OTG1 USART3 USART1 USART2

# Now the first SPI bus.
PA5 SPI1_SCK SPI1
PA6 SPI1_MISO SPI1
PA7 SPI1_MOSI SPI1

# Now we define the pins that USB is connected on.
PA11 USB_FS_DM OTG1
PA12 USB_FS_DP OTG1

# These are the pins for SWD debugging with a STlinkv2 or black-magic probe.
PA13 JTMS-SWDIO SWD
PA14 JTCK-SWCLK SWD

# Now the first I2C bus. The pin speeds are automatically setup
# correctly, but can be overridden here if needed.
PB8 I2C1_SCL I2C1
PB9 I2C1_SDA I2C1

# the 2nd I2C bus
PB10 I2C2_SCL I2C2
PB11 I2C2_SDA I2C2

# the 2nd SPI bus
#PB12 FLOW_CS CS - ne, oder?
PB13 SPI2_SCK SPI2
PB14 SPI2_MISO SPI2
PB15 SPI2_MOSI SPI2

PA2 USART2_TX USART2
PA3 USART2_RX USART2

PA10 USART1_RX USART1
PA9 USART1_TX USART1

#UART3 GPS - denke ich?
PC10 USART3_TX USART3
PC11 USART3_RX USART3

#PC12 USART5_TX USART5
#PD2 USART5_RX USART5

#LEDs
PA8 LEDF OUTPUT LOW GPIO(0)
PB4 LEDR OUTPUT LOW GPIO(1)
PC2 LED3 OUTPUT LOW GPIO(2)

PC0 BATT_MON ADC1 SCALE(4.9)

PB2 BOOT1 INPUT

#PC4 RADIO_CE OUTPUT
#PC5 RADIO_PA_CTL OUTPUT
#PB0 RADIO_IRQ INPUT GPIO(100)

#PB5 TIM3_CH2 TIM3 PWM(2) # marked CN15 front-right
#PB3 I2C2_SDA I2C2
#PD2 OF_MOTION INPUT
#PB4 OF_RESET OUTPUT HIGH

#PC9 TIM3_CH4 TIM3 PWM(4) # marked CN17, rear-right
#PC8 TIM3_CH3 TIM3 PWM(3) # marked CN13, rear-left
#PC6 TIM3_CH1 TIM3 PWM(1) # marked CN3, front-left

define HAL_USE_EMPTY_STORAGE 1
define HAL_STORAGE_SIZE 15360

define HAL_COMPASS_DEFAULT HAL_COMPASS_NONE
define HAL_INS_DEFAULT HAL_INS_NONE
define HAL_BARO_DEFAULT HAL_BARO_NONE

# SPI Device table
#SPIDEV cypress    SPI1 DEVID1 RADIO_CS MODE0 2*MHZ 2*MHZ
#SPIDEV cc2500     SPI1 DEVID1 RADIO_CS MODE0 4*MHZ 4*MHZ
#SPIDEV pixartflow SPI2 DEVID2 FLOW_CS  MODE3 2*MHZ 2*MHZ

# reserve 16k for bootloader and 32k for storage
#FLASH_RESERVE_START_KB 48

#define HAL_CHIBIOS_ARCH_F412 1

#define HAL_INS_DEFAULT HAL_INS_MPU60XX_I2C
#define HAL_INS_DEFAULT_ROTATION ROTATION_NONE
#define HAL_INS_MPU60x0_I2C_BUS 1
#define HAL_INS_MPU60x0_I2C_ADDR 0x68

# radio IRQ is on GPIO(100)
#define HAL_GPIO_RADIO_IRQ 100

#define HAL_RCINPUT_WITH_AP_RADIO 1
#define STORAGE_FLASH_PAGE	 1
#define HAL_STORAGE_SIZE 15360

# setup defines for ArduCopter config
#define TOY_MODE_ENABLED ENABLED
#define ARMING_DELAY_SEC 0
#define LAND_START_ALT 700
#define LAND_DETECTOR_ACCEL_MAX 2.0f
#define ALLOW_ARM_NO_COMPASS

define CHIBIOS_ADC_MAVLINK_DEBUG 1

#define HAL_COMPASS_DEFAULT HAL_COMPASS_BMM150_I2C
#define HAL_COMPASS_BMM150_I2C_BUS   0
#define HAL_COMPASS_BMM150_I2C_ADDR  0x10

#define HAL_BARO_DEFAULT HAL_BARO_20789_I2C_I2C
#define HAL_BARO_20789_I2C_BUS           1
#define HAL_BARO_20789_I2C_ADDR_PRESS 0x63
#define HAL_BARO_20789_I2C_ADDR_ICM   0x68

# unstick 20789 on I2C on boot
#define HAL_I2C_CLEAR_BUS

#env DEFINES CONFIG_HAL_BOARD_SUBTYPE='HAL_BOARD_SUBTYPE_CHIBIOS_SKYVIPER_F412'
#env DEFAULT_PARAMETERS 'Tools/Frame_params/SkyViper-F412/defaults.parm'